<%- include('../includes/usersPartials/userHead.ejs') %>
<style>
  .form-input{
  border: none;
  border-bottom: 2px solid #717fe0;
  border-radius: 0;
}
.form-control:focus{
  box-shadow: none !important;
}
.container-main{
  margin-top: 7%;
}
</style>
<div class="container container-main p-5 border mb-5">
  <div><h2>EDIT ADDRESS</h2></div>
  <form id="form" action="/editAddress/<%=addressDetails._id%>?_method=PATCH&id=<%= userid %>" method="post">
  <div class="row">
    <div class="col-md-6 mt-5">
      <div>
          <label for=""><strong>First Name</strong></label>
          <input value="<%=addressDetails.firstname%>" id="firstname" type="text" name="firstname" class="form-control p-3 mt-1 form-input" placeholder="Enter the firstname">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
    <div class="col-md-6 mt-5">
      <div>
          <label for=""><strong>Last Name</strong></label>
          <input value="<%=addressDetails.lastname%>"  id="lastname" type="text" name="lastname"  class="form-control p-3 mt-1 form-input" placeholder="Enter the lastname">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
  </div>
  <div class="row">
    <div class="col mt-5">
      <div>
        <label for=""><strong>Street/Home Address</strong></label>
          <input value="<%=addressDetails.address%>" id="address" type="text" name="address" class="form-control p-3 mt-1 form-input" placeholder="Street/Home Address">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>State</strong></label>

          <input value="<%=addressDetails.state%>" id="state" type="text" name="state" class="form-control p-3 mt-1 form-input" placeholder="State">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>District</strong></label>

          <input value="<%=addressDetails.district%>" id="district" type="text" name="district" class="form-control p-3 mt-1 form-input" placeholder="Enter your District Name">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>City</strong></label>
          <input value="<%=addressDetails.city%>" id="city" type="text" name="city" class="form-control p-3 mt-1 form-input" placeholder="Enter your city">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>Locality</strong></label>
          <input value="<%=addressDetails.locality%>" id="locality" type="text" name="locality" class="form-control p-3 mt-1 form-input" placeholder="Enter your locality">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>Pin Code</strong></label>
          <input value="<%=addressDetails.postalcode%>" id="postalCode" type="text" name="postalCode" class="form-control p-3 mt-1 form-input" placeholder="Enter your Postal Code">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
    <div class="col-md-6 mt-5">
      <div>
        <label for=""><strong>Phone No</strong></label>
          <input value="<%=addressDetails.phone%>" id="phone" type="text" name="phone" class="form-control p-3 mt-1 form-input" placeholder="Enter your Phone Number">
          <p style="font-size: smaller;" class="mt-2 text-danger warn"></p>
        </div>
    </div>
  </div>
  <div class="d-flex justify-content-end">
  <button type="submit" style="color: #ffffff;background-color: #b04fff;" class="btn mt-4">Make Changes</button>
</div>
</form>
</div>

<script>
  const form = document.getElementById('form');
  const firstname = document.getElementById('firstname');
  const lastname = document.getElementById('lastname');
  const address = document.getElementById('address');
  const state = document.getElementById('state');
  const district = document.getElementById('district');
  const city = document.getElementById('city');
  const locality = document.getElementById('locality');
  const postalCode = document.getElementById('postalCode');
  const phone = document.getElementById('phone');


  form.addEventListener('submit',(e)=>{
    e.preventDefault();

    if(!validateForm()){
      form.submit();
    };
  })

function setError(element,message){
  const inputDiv = element.parentElement;
  const displayMessage = inputDiv.querySelector('.warn');
  displayMessage.innerText = message; 
}



function validateForm (){
  const firstnameVal = firstname.value.trim();
  console.log(firstnameVal);
  const lastnameVal = lastname.value.trim()
  const addressVal = address.value.trim();
  const stateVal = state.value.trim();
  const districtVal = district.value.trim();
  const cityVal = city.value.trim();
  const localityVal = locality.value.trim();
  const postalCodeVal = postalCode.value.trim();
  const phoneVal = phone.value.trim();
let isError = false;
let lettersOnlyRegex = /^[A-Za-z\s]*$/;

  if(!lettersOnlyRegex.test(firstnameVal)){
    isError=true;
    setError(firstname,'Invalid Entry');
  }else{
    setError(firstname,'');
  }

  if(!lettersOnlyRegex.test(lastnameVal)){
    isError=true;
    setError(lastname,'Invalid Entry');
  }else{
    setError(lastname,'');
  }

  if(addressVal === ''){
    isError = false;
    setError(address,'')
  }

  if(!lettersOnlyRegex.test(stateVal)){
    isError = true;
    setError(state,'Invalid Entry');
  }else{
    setError(state,'');
  }

   if(!lettersOnlyRegex.test(districtVal)){
    isError = true;
    setError(district,'Invalid Entry');
  }else{
    setError(district,'');
  }

  if(!lettersOnlyRegex.test(cityVal)){
    isError = true;
    setError(city,'Invalid Entry');
  }else{
    setError(city,'');
  }

  if(localityVal === ''){
    isError = false;
    setError(locality,'')
  }else{
    setError(locality,'');
  }
  const numbersOnlyRegex = /^[0-9]/ ;
  if(!numbersOnlyRegex.test(postalCodeVal)){
    isError = true;
    setError(postalCode,'Invalid Entry');
  }else{
    setError(postalCode,'');
  }

  let mobileRegex = /^\d{10}$/;
  if(!mobileRegex.test(phoneVal)){
    isError = true;
    setError(phone,'Invalid Number');
  }else{
    setError(phone,'');
  }


return isError;
}
</script>
<%- include('../includes/usersPartials/userEnd.ejs') %>
